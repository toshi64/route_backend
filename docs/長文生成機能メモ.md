# Djangoによる長文生成バックエンド構成（＋Supabase連携予定）

---

## 🧠 概要
- 各処理は機能ごとに独立したPythonファイル（コンポーネント）として分離されており、中心制御は`views.py`で行われる。
- 入力されたアンケート情報から、学習者の関心に応じた英語長文を3本生成し、それぞれに補足情報（タイトル・要約・翻訳）を付加。
- 各生成結果は辞書（dict）として個別に構築され、最終的にリストにまとめられる。

---

## 🔄 処理の流れとコンポーネント構成

1. **JSONデータの受信と構造化**
   - コンポーネント：`parse_json.py`
   - Googleフォーム等からPOSTされたアンケート結果を受信し、Pythonの辞書形式に変換。

2. **ユーザープロンプトの生成（1回のみ）**
   - コンポーネント：`user_prompt_generation.py`
   - アンケートデータから学習者の興味・関心を反映したプロンプトを構成。

3. **システムプロンプトの定義（1回のみ）**
   - コンポーネント：`system_prompt_definition.py`
   - 長文生成をガイドする固定的な指示文を定義。

4. **長文生成フェーズ（以下の処理が3回繰り返される）**
   - 各ループでは1つのテーマに基づいた英語長文とその補助情報を生成し、辞書として構築する。

   - ① **長文生成**
     - コンポーネント：`chatgpt_generation.py`
     - プロンプトを元に英語の本文を生成。

   - ② **タイトル生成**
     - コンポーネント：`title_generation.py`
     - 本文にふさわしいタイトルを英語で生成。

   - ③ **タイトル翻訳**
     - コンポーネント：`title_translation.py`
     - 英語タイトルを日本語に翻訳。

   - ④ **要約生成**
     - コンポーネント：`summary_generation.py`
     - 本文のエッセンスを抽出して英語で要約。

   - ⑤ **要約翻訳**
     - コンポーネント：`summary_translation.py`
     - 英語の要約を日本語に翻訳。

5. **生成された各記事（辞書）をリストに格納**
   - 制御スコープにおけるリストに3本分の辞書を順に追加し、全体として統合された出力を形成。

---

## 🧩 設計の特徴

- 各機能が独立モジュールとして実装されており、**テスト性・保守性・再利用性に優れる**。
- 辞書構造を通じて、**状態管理と生成物の蓄積が明示的**に行われる。
- 複数の長文を生成しながら、**共通のプロンプト設計をベースに多角的な出力を生み出す**設計になっている。
- 最終的に得られるリストは、学習者の興味ごとにパーソナライズされた高品質なコンテンツ群となる。

---

## 📦 Supabase連携（今後の拡張）

- 使用予定ライブラリ：`supabase-py`
- 各辞書をリストから1件ずつ取り出し、Supabaseのテーブルに保存予定。
- テーブル設計例：
  - 各行が1記事を表現し、ユーザーID、英語本文、タイトル、要約、翻訳などを含む。

---

## 🚀 今後の展望

- 非同期処理への拡張（3ループを並列化）
- コンテンツの品質評価スコアや学習履歴との連動
- 保存先の切り替え（Supabase ↔ ローカルDB）やバッチ処理対応
- 教材配信システムへの直接連携

